---
title: 数据仓库ClickHouse
date: 2023-11-02 16:20:21
tags:
- 数据仓库
- Clickhouse
---
列式存储的数据仓库
<!-- more -->
# 什么是clickhouse
ClickHouse是一个用于联机分析(**OLAP**)的**列式**数据库管理系统(**DBMS**)。适用于**数仓**的数据存储
# OLAP 场景特征
## 数据特征
* 数据只读
* 宽表，即每个表包含着大量的列
* 数据相对较小
## 查询特征
* 数据更新batch极大
* 读取时，列数少，行数多
* 对查询延迟宽容
* 对查询吞吐量严格
* 事务不是必须的
* 对数据一致性要求低
* 每个查询有一个大表，其他表都很小。
* 查询结果明显小于源数据（过滤聚合较多）
# ClickHouse特性
## 数据存储特征
* 真正的按列存储：不存列长度
* 数据压缩：压缩方法和压缩选项可以在表的定义或列的定义中进行配置。可以为整个表指定压缩方法，也可以为不同的列指定不同的压缩方法。
ClickHouse支持的压缩方法有：
LZ4: 一种高效的无损压缩算法，可以快速压缩和解压缩数据。适用于CPU性能较低的情况，但压缩率相对较低。
ZSTD: 一种快速压缩和解压缩数据的算法，同时具有较高的压缩率。适用于CPU性能较高的情况。
ZLIB: 一种目前广泛应用的压缩算法，具有较高的压缩率，但相对较慢。
LZMA: 一种高压缩率的算法，但相对较慢。适用于对存储空间要求较高的情况。
BLOSC: 一种基于熵编码和Huffman编码的压缩算法，具有很高的压缩率和较快的速度。适用于需要高压缩率和快速查询的情况。
T64: 一种基于Tributary算法的压缩算法，适用于稀疏数据和高度重复的数据。
* 磁盘存储：和只能存内存的列式数据库相比，clickhouse可以用内存和磁盘
## 查询优化特征
* 多核并行
* 分布式：支持容错
* 向量存储：支持按列常用部分（向量）存储
* 索引：按照主键对数据进行排序
* 实时数据更新：写数据也不加锁
* 在线查询：不作预处理，可实现低延迟查询
* 近似计算：聚合计算的时候可以近似计算，拿数据的时候也可以只拿部分近似计算，聚合的时候可以用部分条件近似计算
## 功能性特征
* 支持SQL
* 支持角色控制访问
## 缺陷
* 没有完整的事务支持
* 不支持高频率、低延迟的数据读写（后来支持改数据了）
* 稀疏索引，所以不适合检索单行
# ClickHouse索引

